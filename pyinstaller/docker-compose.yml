# Docker Compose configuration for dirsearch PyInstaller builds
# Uses BuildKit for improved performance and caching
#
# Note: Only Linux builds use Docker. Windows and macOS use native runners.
#
# Usage:
#   DOCKER_BUILDKIT=1 COMPOSE_DOCKER_CLI_BUILD=1 docker compose build
#   docker compose run --rm linux

services:
  linux:
    build:
      context: ..
      dockerfile: pyinstaller/Dockerfile.linux
      target: export
      args:
        BUILDKIT_INLINE_CACHE: 1
    image: dirsearch-build-linux
    volumes:
      - ./dist:/output
    entrypoint: ["/bin/sh", "-c", "cp /dirsearch-linux-amd64 /output/ 2>/dev/null || true"]

  # Builder service for extracting artifacts
  linux-builder:
    build:
      context: ..
      dockerfile: pyinstaller/Dockerfile.linux
      target: builder
    image: dirsearch-builder-linux
    volumes:
      - ./dist:/dist-output
    command: ["cp", "-r", "/app/dist/.", "/dist-output/"]
